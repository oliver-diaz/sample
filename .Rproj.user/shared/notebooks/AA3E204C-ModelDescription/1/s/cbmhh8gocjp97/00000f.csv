"0","#Sample HRs from KOLs by LOT"
"0","## The sampling is per LOT to ensure both PFS and OS survival are adjusted by the sample sampled HR"
"0","HR.data.samp <- list("
"0","  cbind("
"0","        s1   = runif(n_samples, HR.data$t1.hr$low[1], HR.data$t1$up[1]),"
"0","        notst3 = runif(n_samples, HR.data$t1.hr$low[2], HR.data$t1$up[2]),"
"0","        st3    = runif(n_samples, HR.data$t1.hr$low[3], HR.data$t1$up[3])"
"0","  ),"
"0","  cbind("
"0","        s1   = runif(n_samples, HR.data$t2.hr$low[1], HR.data$t2$up[1]),"
"0","        st1  = runif(n_samples, HR.data$t2.hr$low[2], HR.data$t2$up[2]),"
"0","        st2  = runif(n_samples, HR.data$t2.hr$low[3], HR.data$t2$up[3]),"
"0","        st3  = runif(n_samples, HR.data$t2.hr$low[4], HR.data$t2$up[4])"
"0","  ),  "
"0","  cbind("
"0","        s1   = runif(n_samples, HR.data$t3.hr$low[1], HR.data$t3$up[1]),"
"0","        notst3 = runif(n_samples, HR.data$t3.hr$low[2], HR.data$t3$up[2]),"
"0","        st3    = runif(n_samples, HR.data$t3.hr$low[3], HR.data$t3$up[3])"
"0","  ),"
"0","  cbind("
"0","        s1   = runif(n_samples, HR.data$t4.hr$low[1], HR.data$t4$up[1]),"
"0","        st1  = runif(n_samples, HR.data$t4.hr$low[2], HR.data$t4$up[2]),"
"0","        st2  = runif(n_samples, HR.data$t4.hr$low[3], HR.data$t4$up[3]),"
"0","        st3  = runif(n_samples, HR.data$t4.hr$low[4], HR.data$t4$up[4])"
"0","  ),"
"0","  cbind("
"0","        s1   = runif(n_samples, HR.data$t5.hr$low[1], HR.data$t5$up[1]),"
"0","        st1  = runif(n_samples, HR.data$t5.hr$low[2], HR.data$t5$up[2]),"
"0","        st2  = runif(n_samples, HR.data$t5.hr$low[3], HR.data$t5$up[3]),"
"0","        st3  = runif(n_samples, HR.data$t5.hr$low[4], HR.data$t5$up[4])"
"0","  ),"
"0","  cbind("
"0","        s1   = runif(n_samples, HR.data$td.hr$low[1], HR.data$td$up[1]),"
"0","        st1  = runif(n_samples, HR.data$td.hr$low[2], HR.data$td$up[2]),"
"0","        st2  = runif(n_samples, HR.data$td.hr$low[3], HR.data$td$up[3]),"
"0","        st3  = runif(n_samples, HR.data$td.hr$low[4], HR.data$td$up[4])"
"0","  )"
"0",")"
"0",""
"0","# Adjust scale according to (sampled) hazard ratios in HR.data.samp"
"0","# Apply mortality adjustment to all death transitions"
"0","    ## P1-> R1_P2 ----"
"0","    transmod_coef$t1_scale[,`:=`("
"0","      cons   = cons + log(HR.data.samp[[1]][,1]),"
"0","      notst3 =        log(HR.data.samp[[1]][,2]),"
"0","      st3    =        log(HR.data.samp[[1]][,3])"
"0","    )]"
"0","    ### P1-> Death   "
"0","         #The (1+(HR.data.samp[[1]][,1]-1)*mort.adj[1])) adjusts the deviation from 1 of the samples HR"
"0","    transmod_coef$t2_scale[,`:=`( "
"0","      cons   = cons + log((1+(HR.data.samp[[1]][,1]-1)*mort.adj[1])),"
"0","      notst3 =        log((1+(HR.data.samp[[1]][,2]-1)*mort.adj[1])),"
"0","      st3    =        log((1+(HR.data.samp[[1]][,3]-1)*mort.adj[1]))"
"0","    )]"
"0",""
"0","    ###  R1_P2 -> R2_P3"
"0","    transmod_coef$t3_scale[,`:=`( "
"0","      cons   = cons + log(HR.data.samp[[2]][,1]),"
"0","      st1    =        log(HR.data.samp[[2]][,2]),"
"0","      st2    =        log(HR.data.samp[[2]][,3]),"
"0","      st3    =        log(HR.data.samp[[2]][,4])"
"0","    )]"
"0","    ###  R1_P2 -> Death"
"0","         #The (1+(mort.adj[2]-1)) value reflects the mortality adjustment"
"0","    transmod_coef$t4_scale[,`:=`( "
"0","      cons   = cons + log((1+(HR.data.samp[[2]][,1]-1)*mort.adj[2])),"
"0","      st1    =        log((1+(HR.data.samp[[2]][,2]-1)*mort.adj[2])),"
"0","      st2    =        log((1+(HR.data.samp[[2]][,3]-1)*mort.adj[2])),"
"0","      st3    =        log((1+(HR.data.samp[[2]][,4]-1)*mort.adj[2]))"
"0","    )]"
"0","    "
"0","    ### R2_P3 -> R3_P4"
"0","    transmod_coef$t5_scale[,`:=`( "
"0","      cons   = cons + log(HR.data.samp[[3]][,1]),"
"0","      notst3 =        log(HR.data.samp[[3]][,2]),"
"0","      st3    =        log(HR.data.samp[[3]][,3])"
"0","    )]"
"0","    ### R2_P3 -> Death"
"0","    transmod_coef$t6_scale[ , `:=`( "
"0","      cons   = cons + log((1+(HR.data.samp[[3]][,1]-1)*mort.adj[3])),"
"0","      notst3 =        log((1+(HR.data.samp[[3]][,2]-1)*mort.adj[3])),"
"0","      st3    =        log((1+(HR.data.samp[[3]][,3]-1)*mort.adj[3]))"
"0","    )]"
"0","    "
"0","    ### R3_P4 -> R4_P5"
"0","    transmod_coef$t3_scale[,`:=`( "
"0","      cons   = cons + log(HR.data.samp[[4]][,1]),"
"0","      st1    =        log(HR.data.samp[[4]][,2]),"
"0","      st2    =        log(HR.data.samp[[4]][,3]),"
"0","      st3    =        log(HR.data.samp[[4]][,4])"
"0","    )]"
"0","    ### R3_P4 -> Death"
"0","    transmod_coef$t8_scale[, `:=`( "
"0","      cons   = cons + log((1+(HR.data.samp[[4]][,1]-1)*mort.adj[4])),"
"0","      st1    =        log((1+(HR.data.samp[[4]][,2]-1)*mort.adj[4])),"
"0","      st2    =        log((1+(HR.data.samp[[4]][,3]-1)*mort.adj[4])),"
"0","      st3    =        log((1+(HR.data.samp[[4]][,4]-1)*mort.adj[4]))"
"0","    )]"
"0","    "
"0","    ### R4_P5 -> R5"
"0","    transmod_coef$t3_scale[,`:=`( "
"0","      cons   = cons + log(HR.data.samp[[5]][,1]),"
"0","      st1    =        log(HR.data.samp[[5]][,2]),"
"0","      st2    =        log(HR.data.samp[[5]][,3]),"
"0","      st3    =        log(HR.data.samp[[5]][,4])"
"0","    )]"
"0","    ### R4_P5 -> Death"
"0","    transmod_coef$t10_scale[, `:=`( "
"0","      cons   = cons + log((1+(HR.data.samp[[5]][,1]-1)*mort.adj[5])),"
"0","      st1    =        log((1+(HR.data.samp[[5]][,2]-1)*mort.adj[5])),"
"0","      st2    =        log((1+(HR.data.samp[[5]][,3]-1)*mort.adj[5])),"
"0","      st3    =        log((1+(HR.data.samp[[5]][,4]-1)*mort.adj[5]))"
"0","    )]"
"0","    "
"0","    ### R5 -> Death"
"0","    transmod_coef$t11_scale[, `:=`( "
"0","      cons   = cons + log(HR.data.samp[[6]][,1]),"
"0","      st1    =        log(HR.data.samp[[6]][,2]),"
"0","      st2    =        log(HR.data.samp[[6]][,3]),"
"0","      st3    =        log(HR.data.samp[[6]][,4])"
"0","    )]"
"0","    rm(weilph.fit, HR.data, HR.data.samp)"
"0",""
